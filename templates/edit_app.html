<!DOCTYPE html>
<html>
<head>
  <title>Edit Hosting Application</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" 
  integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" 
  crossorigin="anonymous">
</head>
<body>
  <!-- Navigation bar -->
  <nav class="bg-blue-500 py-4 px-6 flex justify-between items-center">
    <div>
      <a href="/" class="text-white font-bold text-lg">Home</a>
      <a href="/dashboard" class="text-white font-bold text-lg mx-4">Dashboard</a>
    </div>
    <a href="/logout" class="text-white font-bold text-lg"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </nav>

  <div class="container mx-auto">
    <h1 class="text-4xl font-bold my-4">Edit Hosting Application</h1>

    <!-- Application form -->
    <form method="POST" action="/apps/{{ hosting_app.id }}/edit" class="my-4">
      <label for="name" class="block font-bold">Name:</label>
      <input type="text" id="name" name="name" value="{{ hosting_app.name }}" required class="border border-gray-300 px-2 py-1 rounded">
      <label for="domain" class="block font-bold">Domain:</label>
      <input type="text" id="domain" name="domain" value="{{ hosting_app.domain }}" required class="border border-gray-300 px-2 py-1 rounded">
      <label for="plan" class="block font-bold">Plan:</label>
      <input type="text" id="plan" name="plan" value="{{ hosting_app.plan }}" required class="border border-gray-300 px-2 py-1 rounded">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Save Changes</button>
    </form>

    <!-- File upload form -->
    <h2 class="text-2xl font-bold my-4">Upload Additional Files</h2>
    <form method="POST" action="/apps/{{ hosting_app.id }}/upload" enctype="multipart/form-data" class="mb-4">
      <label for="website_file" class="block">Select File:</label>
      <input type="file" id="website_file" name="website_file" required class="mb-2">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Upload File</button>
    </form>

    <!-- Create folder form -->
    <h2 class="text-2xl font-bold my-4">Create New Folder</h2>
    <form method="POST" action="/apps/{{ hosting_app.id }}/create-folder" class="mb-4">
      <label for="folder_name" class="block">Folder Name:</label>
      <input type="text" id="folder_name" name="folder_name" required class="mb-2">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Create Folder</button>
    </form>

    <!-- List of existing files -->

<h2 class="text-2xl font-bold my-4">Existing Files</h2>
<!-- Go Back link -->
{% if current_subfolder %}
  <a href="/apps/{{ hosting_app.id }}/edit?subfolder={{ parent_folder }}" class="text-blue-500 hover:underline"><i class="fas fa-chevron-left"></i> Go Back</a>
{% endif %}
<ul>
  {% for item in files %}
      {% if item.type == 'folder' %}
          <!-- Link the folder so you can navigate into it -->
          <li>
              <i class="fas fa-folder"></i>
              <a href="{{ url_for('edit_app', app_id=hosting_app.id, subfolder=current_subfolder ~ '/' ~ item.name) }}">{{ item.name }}</a>
          </li>
      {% else %}
          <li>
              <i class="fas fa-file"></i>
              <a href="/websites/{{ hosting_app.user_id }}/{{ hosting_app.website_id }}/{{ current_subfolder ~ '/' ~ item.name }}">{{ item.name }}</a>
              <a href="#" onclick="openEditor('{{ current_subfolder ~ '/' ~ item.name }}')" class="text-blue-500 hover:underline"><i class="fas fa-edit"></i> Edit</a>
              <a href="/apps/{{ hosting_app.id }}/delete-file?file={{ current_subfolder ~ '/' ~ item.name }}" onclick="return confirm('Are you sure you want to delete this file?');" class="text-red-500 hover:underline"><i class="fas fa-trash-alt"></i> Delete</a>
          </li>
      {% endif %}
  {% endfor %}
</ul>
...


    <!-- File Editor Modal -->
    <div id="fileEditorModal" style="display: none;">
      <h2 class="text-2xl font-bold my-4">Edit File</h2>
      <form id="fileEditorForm" method="POST">
        <textarea id="fileContent" style="width: 100%; height: 300px;" class="border border-gray-300 p-2"></textarea>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Save Changes</button>
      </form>
    </div>

    <!-- Upload and Unzip Form -->
    <h2 class="text-2xl font-bold my-4">Upload and Unzip File</h2>
    <form method="POST" action="/apps/{{ hosting_app.id }}/upload-unzip" enctype="multipart/form-data" class="mb-4">
      <label for="zip_file" class="block">Select Zip File:</label>
      <input type="file" id="zip_file" name="zip_file" required class="mb-2">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Upload and Unzip</button>
    </form>
  </div>

  <script>
    function openEditor(filename) {
      fetch('/apps/{{ hosting_app.id }}/get-file?file=' + filename)
        .then(response => response.json())
        .then(data => {
          document.getElementById('fileContent').value = data.content;
          document.getElementById('fileEditorModal').style.display = 'block';
          document.getElementById('fileEditorForm').onsubmit = function(e) {
            e.preventDefault();
            var content = document.getElementById('fileContent').value;
            fetch('/apps/{{ hosting_app.id }}/save-file', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: new URLSearchParams({
                'filename': filename,
                'content': content,
              }),
            })
            .then(response => response.json())
            .then(data => {
              alert(data.message);
              document.getElementById('fileEditorModal').style.display = 'none';
            });
          };
        });
    }
  </script>

</body>
</html>
